# Há»‡ thá»‘ng PhÃ¢n quyá»n CVKing

## Tá»•ng quan

Há»‡ thá»‘ng phÃ¢n quyá»n Ä‘Æ°á»£c triá»ƒn khai Ä‘á»ƒ Ä‘áº£m báº£o tá»«ng vai trÃ² ngÆ°á»i dÃ¹ng chá»‰ cÃ³ thá»ƒ truy cáº­p vÃ  thá»±c hiá»‡n cÃ¡c chá»©c nÄƒng phÃ¹ há»£p vá»›i trÃ¡ch nhiá»‡m cá»§a há».

## CÃ¡c Vai trÃ² (Roles)

### 1. **ADMIN** (Quáº£n trá»‹ há»‡ thá»‘ng)
- **MÃ´ táº£**: TÃ i khoáº£n cao nháº¥t cá»§a chá»§ ná»n táº£ng tuyá»ƒn dá»¥ng (chá»‰ cÃ³ 1 tÃ i khoáº£n)
- **Quyá»n háº¡n**:
  - âœ… Quáº£n lÃ½ toÃ n bá»™ ngÆ°á»i dÃ¹ng há»‡ thá»‘ng (`manage_users`)
  - âœ… Quáº£n lÃ½ vai trÃ² vÃ  phÃ¢n quyá»n (`manage_roles`)
  - âœ… Quáº£n lÃ½ cÃ¡c cÃ´ng ty (`manage_companies`)
  - âœ… Duyá»‡t cÃ´ng ty má»›i Ä‘Äƒng kÃ½ (`approve_companies`)
  - âœ… Quáº£n lÃ½ táº¥t cáº£ tin tuyá»ƒn dá»¥ng (`manage_jobs`)
  - âœ… Kiá»ƒm duyá»‡t ná»™i dung (`moderate_content`)
  - âœ… Quáº£n lÃ½ gÃ³i dá»‹ch vá»¥ (`manage_packages`)
  - âœ… Quáº£n lÃ½ thanh toÃ¡n (`manage_payments`)
  - âœ… Xem bÃ¡o cÃ¡o phÃ¢n tÃ­ch (`view_analytics`)
  - âœ… Cáº¥u hÃ¬nh há»‡ thá»‘ng (`system_config`)
  - âœ… GiÃ¡m sÃ¡t há»‡ thá»‘ng (`system_monitoring`)

### 2. **EMPLOYER** (NhÃ  tuyá»ƒn dá»¥ng)
- **MÃ´ táº£**: TÃ i khoáº£n cá»§a cÃ´ng ty hoáº·c ngÆ°á»i Ä‘áº¡i diá»‡n (CEO, Manager, Owner)
- **Quyá»n háº¡n**:
  - âœ… Táº¡o thÃ´ng tin cÃ´ng ty (`create_company_profile`)
  - âœ… Quáº£n lÃ½ há»“ sÆ¡ cÃ´ng ty (`manage_company_profile`)
  - âœ… ÄÄƒng tin tuyá»ƒn dá»¥ng (`post_jobs`)
  - âœ… Quáº£n lÃ½ tin tuyá»ƒn dá»¥ng (`manage_job_postings`)
  - âœ… Xem Ä‘Æ¡n á»©ng tuyá»ƒn cá»§a cÃ´ng ty (`view_company_applications`)
  - âœ… Quáº£n lÃ½ team HR (`manage_company_hr`)
  - âœ… Xem bÃ¡o cÃ¡o tuyá»ƒn dá»¥ng (`view_recruitment_reports`)
  - âœ… NÃ¢ng cáº¥p gÃ³i dá»‹ch vá»¥ (`upgrade_packages`)

### 3. **HR** (Human Resources - NhÃ¢n sá»±)
- **MÃ´ táº£**: TÃ i khoáº£n do Employer táº¡o, quyá»n tháº¥p hÆ¡n Employer, lÃ m viá»‡c trong pháº¡m vi cÃ´ng ty
- **Quyá»n háº¡n theo chá»©c nÄƒng**:

#### ğŸ¢ **Tuyá»ƒn dá»¥ng trong cÃ´ng ty (Company Recruitment)**
- âœ… Xem tin tuyá»ƒn dá»¥ng cá»§a cÃ´ng ty (`view_company_jobs`)
- âœ… Xá»­ lÃ½ á»©ng viÃªn (`process_candidates`)
- âœ… Äá»c vÃ  Ä‘Ã¡nh giÃ¡ CV (`review_resumes`)
- âœ… LiÃªn há»‡ á»©ng viÃªn (`contact_candidates`)
- âœ… Cháº¥m Ä‘iá»ƒm á»©ng viÃªn (`score_candidates`)
- âœ… Táº¡o lá»‹ch phá»ng váº¥n (`create_interviews`)
- âœ… Quáº£n lÃ½ phá»ng váº¥n (`manage_interviews`)
- âœ… Chat vá»›i á»©ng viÃªn (`chat_with_candidates`)
- âœ… ÄÄƒng tin náº¿u Employer cho phÃ©p (`post_jobs_if_allowed`)

### 4. **JOB_SEEKER** (NgÆ°á»i tÃ¬m viá»‡c)
- **MÃ´ táº£**: TÃ i khoáº£n cá»§a á»©ng viÃªn (Developer, Designer, Tester, Sinh viÃªn...)
- **Quyá»n háº¡n**:
  - âœ… Táº¡o há»“ sÆ¡ cÃ¡ nhÃ¢n (`create_profile`)
  - âœ… Quáº£n lÃ½ CV (`manage_resume`)
  - âœ… Upload CV PDF (`upload_cv`)
  - âœ… Chá»n template CV (`choose_templates`)
  - âœ… á»¨ng tuyá»ƒn cÃ´ng viá»‡c (`apply_to_jobs`)
  - âœ… Theo dÃµi tráº¡ng thÃ¡i há»“ sÆ¡ (`track_applications`)
  - âœ… Nháº­n thÃ´ng bÃ¡o (`receive_notifications`)
  - âœ… Nháº­n feedback (`receive_feedback`)
  - âœ… LÆ°u cÃ´ng viá»‡c yÃªu thÃ­ch (`save_jobs`)

### 5. **Blog Permissions** (Quyá»n Blog Theo Vai TrÃ²)

#### **ADMIN vá»›i Blog:**
- âœ… Viáº¿t blog chÃ­nh thá»©c há»‡ thá»‘ng (`write_system_blogs`)
- âœ… Duyá»‡t/tá»« chá»‘i blog tá»« Employer/HR (`approve_blog_posts`)
- âœ… KhoÃ¡/xÃ³a bÃ i viáº¿t vi pháº¡m (`delete_any_blog_post`)
- âœ… Quáº£n lÃ½ category, chá»§ Ä‘á» (`manage_blog_categories`)
- âœ… Quáº£n lÃ½ bÃ¬nh luáº­n, bÃ¡o cÃ¡o xáº¥u
- âœ… Thá»‘ng kÃª blog (views, likes, shares) (`view_blog_analytics`)
- **Má»¥c Ä‘Ã­ch**: ThÃ´ng bÃ¡o há»‡ thá»‘ng, hÆ°á»›ng dáº«n, tin tá»©c ngÃ nh, PR ná»n táº£ng

#### **EMPLOYER vá»›i Blog:**
- âœ… Viáº¿t blog quáº£ng bÃ¡ cÃ´ng ty (`write_company_blogs`)
- âœ… Sá»­a/xÃ³a bÃ i viáº¿t cÃ´ng ty (`edit_own_blogs`, `delete_own_blogs`)
- âœ… Quáº£n lÃ½ bÃ¬nh luáº­n bÃ i cÃ´ng ty (`manage_company_blog_comments`)
- âœ… Äá»c, bÃ¬nh luáº­n, like, share (`comment_on_blogs`, `like_blog_posts`, `share_blog_posts`)
- âŒ **KhÃ´ng Ä‘Æ°á»£c** xÃ³a blog cÃ´ng ty khÃ¡c
- âŒ **KhÃ´ng Ä‘Æ°á»£c** viáº¿t blog thay HR (trá»« khi HR Ä‘Äƒng dÆ°á»›i quyá»n)
- **Má»¥c Ä‘Ã­ch**: Giá»›i thiá»‡u vÄƒn hÃ³a, cÆ¡ há»™i nghá» nghiá»‡p, sá»± kiá»‡n, PR thÆ°Æ¡ng hiá»‡u

#### **HR vá»›i Blog:**
- âœ… Viáº¿t blog tuyá»ƒn dá»¥ng (`write_recruitment_blogs`)
- âœ… Sá»­a/xÃ³a bÃ i viáº¿t cá»§a mÃ¬nh (`edit_own_blogs`, `delete_own_blogs`)
- âœ… Quáº£n lÃ½ bÃ¬nh luáº­n cá»§a mÃ¬nh (`manage_own_comments`)
- âœ… Äá»c, bÃ¬nh luáº­n, like, share (`comment_on_blogs`, `like_blog_posts`, `share_blog_posts`)
- âŒ **KhÃ´ng Ä‘Æ°á»£c** xÃ³a blog cÃ´ng ty
- âŒ **KhÃ´ng Ä‘Æ°á»£c** duyá»‡t blog, xÃ³a blog HR khÃ¡c
- âŒ **KhÃ´ng Ä‘Æ°á»£c** quáº£n lÃ½ blog toÃ n há»‡ thá»‘ng
- **Má»¥c Ä‘Ã­ch**: BÃ i vá» nghá» nghiá»‡p, tuyá»ƒn dá»¥ng, giá»›i thiá»‡u job, kinh nghiá»‡m phá»ng váº¥n

#### **JOB SEEKER vá»›i Blog:**
- **Tuá»³ loáº¡i há»‡ thá»‘ng:**
- **Náº¿u KHÃ”NG pháº£i máº¡ng xÃ£ há»™i:**
  - âŒ KhÃ´ng Ä‘Æ°á»£c viáº¿t blog
  - âœ… Chá»‰ Ä‘á»c, chia sáº», bÃ¬nh luáº­n (náº¿u báº­t)
- **Náº¿u cÃ³ tÃ­nh nÄƒng chia sáº» cÃ¡ nhÃ¢n (nhÆ° LinkedIn):**
  - âœ… Viáº¿t bÃ i chia sáº» cÃ¡ nhÃ¢n (`write_personal_blogs` - optional)
  - âœ… BÃ¬nh luáº­n, like, bookmark (`comment_on_blogs`, `like_blog_posts`, `bookmark_blogs`)
  - âœ… BÃ¡o cÃ¡o ná»™i dung xáº¥u (`report_blog_content`)
  - âŒ BÃ i viáº¿t thÆ°á»ng khÃ´ng Ä‘Æ°á»£c Admin duyá»‡t

## Chi tiáº¿t Quyá»n háº¡n theo Chá»©c nÄƒng

### Quáº£n trá»‹ Há»‡ thá»‘ng (System Administration)
| Quyá»n | ADMIN | EMPLOYER | HR | JOB_SEEKER |
|-------|-------|----------|----|------------|
| `manage_users` | âœ… | âŒ | âŒ | âŒ |
| `manage_roles` | âœ… | âŒ | âŒ | âŒ |
| `manage_companies` | âœ… | âŒ | âŒ | âŒ |
| `approve_companies` | âœ… | âŒ | âŒ | âŒ |
| `manage_jobs` | âœ… | âŒ | âŒ | âŒ |
| `moderate_content` | âœ… | âŒ | âŒ | âŒ |
| `manage_packages` | âœ… | âŒ | âŒ | âŒ |
| `manage_payments` | âœ… | âŒ | âŒ | âŒ |
| `view_analytics` | âœ… | âŒ | âŒ | âŒ |
| `system_config` | âœ… | âŒ | âŒ | âŒ |
| `system_monitoring` | âœ… | âŒ | âŒ | âŒ |

### Quáº£n lÃ½ CÃ´ng ty (Company Management)
| Quyá»n | ADMIN | EMPLOYER | HR | JOB_SEEKER |
|-------|-------|----------|----|------------|
| `create_company_profile` | âœ… | âœ… | âŒ | âŒ |
| `manage_company_profile` | âœ… | âœ… | âŒ | âŒ |
| `manage_company_hr` | âœ… | âœ… | âŒ | âŒ |
| `view_recruitment_reports` | âœ… | âœ… | âŒ | âŒ |
| `upgrade_packages` | âœ… | âœ… | âŒ | âŒ |

### Tuyá»ƒn dá»¥ng (Recruitment)
| Quyá»n | ADMIN | EMPLOYER | HR | JOB_SEEKER |
|-------|-------|----------|----|------------|
| `post_jobs` | âœ… | âœ… | âŒ | âŒ |
| `manage_job_postings` | âœ… | âœ… | âŒ | âŒ |
| `view_company_applications` | âœ… | âœ… | âŒ | âŒ |
| `view_company_jobs` | âœ… | âœ… | âœ… | âŒ |
| `process_candidates` | âœ… | âœ… | âœ… | âŒ |
| `review_resumes` | âœ… | âœ… | âœ… | âŒ |
| `contact_candidates` | âœ… | âœ… | âœ… | âŒ |
| `score_candidates` | âœ… | âœ… | âœ… | âŒ |
| `create_interviews` | âœ… | âœ… | âœ… | âŒ |
| `manage_interviews` | âœ… | âœ… | âœ… | âŒ |
| `chat_with_candidates` | âœ… | âœ… | âœ… | âŒ |
| `post_jobs_if_allowed` | âœ… | âœ… | âœ… | âŒ |

### Blog Management (Quáº£n lÃ½ Blog)
| Quyá»n | ADMIN | EMPLOYER | HR | JOB_SEEKER |
|-------|-------|----------|----|------------|
| `manage_blog_categories` | âœ… | âŒ | âŒ | âŒ |
| `approve_blog_posts` | âœ… | âŒ | âŒ | âŒ |
| `delete_any_blog_post` | âœ… | âŒ | âŒ | âŒ |
| `write_system_blogs` | âœ… | âŒ | âŒ | âŒ |
| `view_blog_analytics` | âœ… | âŒ | âŒ | âŒ |
| `write_company_blogs` | âœ… | âœ… | âŒ | âŒ |
| `write_recruitment_blogs` | âœ… | âœ… | âœ… | âŒ |
| `write_personal_blogs` | âœ… | âœ… | âœ… | âœ…* |
| `edit_own_blogs` | âœ… | âœ… | âœ… | âœ…* |
| `delete_own_blogs` | âœ… | âœ… | âœ… | âœ…* |
| `manage_own_comments` | âœ… | âœ… | âœ… | âœ… |
| `manage_company_blog_comments` | âœ… | âœ… | âŒ | âŒ |
| `comment_on_blogs` | âœ… | âœ… | âœ… | âœ… |
| `like_blog_posts` | âœ… | âœ… | âœ… | âœ… |
| `share_blog_posts` | âœ… | âœ… | âœ… | âœ… |
| `bookmark_blogs` | âœ… | âœ… | âœ… | âœ… |
| `report_blog_content` | âœ… | âœ… | âœ… | âœ… |

_*Optional - depends on platform type (social network vs job board)_

### á»¨ng viÃªn & Há»“ sÆ¡ (Job Seekers & Profiles)
| Quyá»n | ADMIN | EMPLOYER | HR | JOB_SEEKER |
|-------|-------|----------|----|------------|
| `create_profile` | âœ… | âœ… | âœ… | âœ… |
| `manage_resume` | âœ… | âœ… | âœ… | âœ… |
| `upload_cv` | âœ… | âœ… | âœ… | âœ… |
| `choose_templates` | âœ… | âœ… | âœ… | âœ… |
| `apply_to_jobs` | âœ… | âœ… | âœ… | âœ… |
| `track_applications` | âœ… | âœ… | âœ… | âœ… |
| `receive_notifications` | âœ… | âœ… | âœ… | âœ… |
| `receive_feedback` | âœ… | âœ… | âœ… | âœ… |
| `save_jobs` | âœ… | âœ… | âœ… | âœ… |

## CÃ¡ch sá»­ dá»¥ng trong Code

### 1. Decorator cho Controller
```typescript
@Post()
@UseGuards(JwtGuard, RolesGuard)
@RequirePermissions(Permission.POST_JOBS)
async createJob(@Body() dto: CreateJobDto) {
  // Chá»‰ user cÃ³ quyá»n POST_JOBS má»›i truy cáº­p Ä‘Æ°á»£c
}
```

### 2. Decorator cho Role
```typescript
@Get('admin-only')
@UseGuards(JwtGuard, RolesGuard)
@Roles(RoleName.ADMIN)
async getAdminData() {
  // Chá»‰ ADMIN má»›i truy cáº­p Ä‘Æ°á»£c
}
```

### 3. Multiple Permissions
```typescript
@Post('manage-employee')
@UseGuards(JwtGuard, RolesGuard)
@RequirePermissions(Permission.EMPLOYEE_MANAGEMENT, Permission.PAYROLL_MANAGEMENT)
async manageEmployee(@Body() dto: EmployeeDto) {
  // Cáº§n cáº£ 2 quyá»n EMPLOYEE_MANAGEMENT vÃ  PAYROLL_MANAGEMENT
}
```

## Kiá»ƒm tra Quyá»n trong Service

```typescript
@Injectable()
export class JobsService {
  async create(createJobDto: CreateJobDto, userId: string) {
    // Kiá»ƒm tra quyá»n trong service logic
    const userPermissions = await this.getUserPermissions(userId);
    if (!userPermissions.includes(Permission.POST_JOBS)) {
      throw new ForbiddenException('Insufficient permissions');
    }
    // ... tiáº¿p tá»¥c logic
  }
}
```

## VÃ­ dá»¥ thá»±c táº¿

### Admin (Chá»§ ná»n táº£ng) cÃ³ thá»ƒ lÃ m gÃ¬?
- âœ… **Quáº£n lÃ½ toÃ n bá»™ há»‡ thá»‘ng**: Táº¥t cáº£ ngÆ°á»i dÃ¹ng, cÃ´ng ty, tin tuyá»ƒn dá»¥ng
- âœ… **Duyá»‡t vÃ  kiá»ƒm duyá»‡t**: CÃ´ng ty má»›i, ná»™i dung spam
- âœ… **Quáº£n lÃ½ thanh toÃ¡n**: GÃ³i dá»‹ch vá»¥, hÃ³a Ä‘Æ¡n
- âœ… **GiÃ¡m sÃ¡t há»‡ thá»‘ng**: Logs, bÃ¡o cÃ¡o phÃ¢n tÃ­ch
- âœ… **Cáº¥u hÃ¬nh há»‡ thá»‘ng**: Settings, maintenance

### Employer (CEO/Manager) cÃ³ thá»ƒ lÃ m gÃ¬?
- âœ… **Quáº£n lÃ½ cÃ´ng ty**: Táº¡o/sá»­a há»“ sÆ¡ cÃ´ng ty
- âœ… **ÄÄƒng tin tuyá»ƒn dá»¥ng**: Táº¡o job postings
- âœ… **Quáº£n lÃ½ team HR**: Má»i HR vÃ o cÃ´ng ty
- âœ… **Xem bÃ¡o cÃ¡o**: Thá»‘ng kÃª tuyá»ƒn dá»¥ng
- âœ… **NÃ¢ng cáº¥p gÃ³i**: Upgrade service packages
- âœ… **Xem Ä‘Æ¡n á»©ng tuyá»ƒn**: Chá»‰ cá»§a cÃ´ng ty mÃ¬nh
- âŒ **KhÃ´ng thá»ƒ** can thiá»‡p cÃ´ng ty khÃ¡c
- âŒ **KhÃ´ng thá»ƒ** quáº£n lÃ½ toÃ n há»‡ thá»‘ng

### HR (NhÃ¢n viÃªn tuyá»ƒn dá»¥ng) cÃ³ thá»ƒ lÃ m gÃ¬?
- âœ… **Tuyá»ƒn dá»¥ng trong cÃ´ng ty**: Xem job postings cá»§a cÃ´ng ty
- âœ… **Xá»­ lÃ½ CV**: Äá»c, Ä‘Ã¡nh giÃ¡, cháº¥m Ä‘iá»ƒm á»©ng viÃªn
- âœ… **LiÃªn há»‡ á»©ng viÃªn**: Gá»i Ä‘iá»‡n, email, chat
- âœ… **Quáº£n lÃ½ phá»ng váº¥n**: Táº¡o lá»‹ch, ghi chÃº, feedback
- âœ… **Chat vá»›i á»©ng viÃªn**: TrÃ² chuyá»‡n trá»±c tiáº¿p
- âœ… **ÄÄƒng tin náº¿u Ä‘Æ°á»£c phÃ©p**: Náº¿u Employer cho phÃ©p
- âŒ **KhÃ´ng thá»ƒ** quáº£n lÃ½ tÃ i khoáº£n cÃ´ng ty
- âŒ **KhÃ´ng thá»ƒ** má»i HR khÃ¡c vÃ o cÃ´ng ty
- âŒ **KhÃ´ng thá»ƒ** xem dá»¯ liá»‡u cÃ´ng ty khÃ¡c

### Job Seeker (á»¨ng viÃªn) cÃ³ thá»ƒ lÃ m gÃ¬?
- âœ… **Táº¡o há»“ sÆ¡**: Profile cÃ¡ nhÃ¢n, CV
- âœ… **Upload CV**: PDF, chá»n template
- âœ… **á»¨ng tuyá»ƒn**: Apply to jobs
- âœ… **Theo dÃµi**: Tráº¡ng thÃ¡i há»“ sÆ¡, lá»‹ch phá»ng váº¥n
- âœ… **Nháº­n thÃ´ng bÃ¡o**: Interview invites, feedback
- âœ… **LÆ°u jobs**: Favorite jobs
- âŒ **KhÃ´ng thá»ƒ** Ä‘Äƒng tin tuyá»ƒn dá»¥ng
- âŒ **KhÃ´ng thá»ƒ** xem CV cá»§a ngÆ°á»i khÃ¡c

## Báº£o máº­t & Kiá»ƒm soÃ¡t

- **JWT Authentication**: Táº¥t cáº£ API protected Ä‘á»u yÃªu cáº§u JWT token
- **Role-based Access Control**: Kiá»ƒm tra vai trÃ² ngÆ°á»i dÃ¹ng
- **Permission-based Access**: Kiá»ƒm tra quyá»n cá»¥ thá»ƒ cho tá»«ng chá»©c nÄƒng
- **Hierarchical Permissions**: Admin cÃ³ táº¥t cáº£ quyá»n, HR cÃ³ quyá»n má»Ÿ rá»™ng, Employer cÃ³ quyá»n cÆ¡ báº£n
- **Database-level Security**: Quyá»n Ä‘Æ°á»£c lÆ°u trá»¯ vÃ  kiá»ƒm tra tá»« database

## Má»Ÿ rá»™ng Há»‡ thá»‘ng

Äá»ƒ thÃªm quyá»n má»›i:
1. ThÃªm enum `Permission` trong `role.entity.ts`
2. Cáº­p nháº­t `RolePermissions` mapping
3. Sá»­ dá»¥ng `@RequirePermissions()` decorator
4. Test ká»¹ cÃ¡c trÆ°á»ng há»£p edge case

Há»‡ thá»‘ng nÃ y Ä‘áº£m báº£o tÃ­nh báº£o máº­t cao vÃ  linh hoáº¡t Ä‘á»ƒ má»Ÿ rá»™ng theo nhu cáº§u kinh doanh.
